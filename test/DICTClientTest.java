import org.junit.jupiter.api.Test;

import java.io.IOException;
import java.util.List;
import java.util.Map;

import static org.junit.jupiter.api.Assertions.assertEquals;

class DICTClientTest {
    private static class StubBackend implements DICTClient.Backend {
        private final Map<String, String> cannedResponses = Map.of(
                "","",
                "DEFINE test hello", "150 1 definitions retrieved\n151 \"Hello\" test \"Test Dictionary\"\nA greeting\n.\n250 ok [d/m/c = 1/0/16; 0.000r 0.000u 0.000s]\n",
                "DEFINE gcide hello", "150 1 definitions retrieved\n151 \"Hello\" gcide \"The Collaborative International Dictionary of English v.0.48\"\nHello \"Hel*lo\"\\, interj. & n.\n   An exclamation used as a greeting, to call attention, as an\n   exclamation of surprise, or to encourage one. This variant of\n   {Halloo} and {Holloo} has become the dominant form. In the\n   United States, it is the most common greeting used in\n   answering a telephone.\n   [1913 Webster +PJC]\n.\n250 ok [d/m/c = 1/0/16; 0.000r 0.000u 0.000s]\n",
                "DEFINE * hello", "\n150 4 definitions retrieved\n151 \"Hello\" gcide \"The Collaborative International Dictionary of English v.0.48\"\nHello \\\\Hel*lo\"\\\\, interj. & n.\n   An exclamation used as a greeting, to call attention, as an\n   exclamation of surprise, or to encourage one. This variant of\n   {Halloo} and {Holloo} has become the dominant form. In the\n   United States, it is the most common greeting used in\n   answering a telephone.\n   [1913 Webster +PJC]\n.\n151 \"hello\" wn \"WordNet (r) 3.0 (2006)\"\nhello\n    n 1: an expression of greeting; \"every morning they exchanged\n         polite hellos\" [syn: {hello}, {hullo}, {hi}, {howdy}, {how-\n         do-you-do}]\n.\n151 \"hello\" moby-thesaurus \"Moby Thesaurus II by Grady Ward, 1.0\"\n19 Moby Thesaurus words for \"hello\":\n   accost, address, bob, bow, curtsy, embrace, greeting, hail,\n   hand-clasp, handshake, how-do-you-do, hug, kiss, nod, salutation,\n   salute, smile, smile of recognition, wave\n\n\n\n.\n151 \"hello\" foldoc \"The Free On-line Dictionary of Computing (30 December 2018)\"\nhello, world\nhello\n\n   <programming> The canonical, minimal, first program that a\n   programmer writes in a new {programming language} or {development\n   environment}.  The program just prints \"hello, world\" to {standard\n   output} in order to verify that the programmer can successfully\n   edit, compile and run a simple program before embarking on\n   anything more challenging.\n\n   Hello, world is the first example program in the {C} programming\n   book, {K&R}, and the tradition has spread from there to pretty\n   much every other language and many of their textbooks.\n\n   Environments that generate an unreasonably large executable\n   for this trivial test or which require a {hairy}\n   compiler-linker invocation to generate it are considered bad.\n\n   {Hello, World in over 400 programming languages\n   (http://www.roesler-ac.de/wolfram/hello.htm)}.\n\n   (2013-10-27)\n\n.\n250 ok [d/m/c = 4/0/139; 0.000r 0.000u 0.000s]\n",
                "SHOW DB", "220 dict.dict.org dictd 1.12.1/rf on Linux 4.19.0-10-amd64 <auth.mime> <294083513.26538.1712783683@dict.dict.org>\n110 166 databases present\ngcide The Collaborative International Dictionary of English v.0.48\nwn \"WordNet (r) 3.0 (2006)\nmoby-thesaurus \"Moby Thesaurus II by Grady Ward, 1.0\nelements \"The Elements (07Nov00)\nvera \"V.E.R.A. -- Virtual Entity of Relevant Acronyms (February 2016)\njargon \"The Jargon File (version 4.4.7, 29 Dec 2003)\nfoldoc \"The Free On-line Dictionary of Computing (30 December 2018)\neaston \"Easton's 1897 Bible Dictionary\nhitchcock \"Hitchcock's Bible Names Dictionary (late 1800's)\nbouvier \"Bouvier's Law Dictionary, Revised 6th Ed (1856)\ndevil \"The Devil's Dictionary (1881-1906)\nworld02 \"CIA World Factbook 2002\ngaz2k-counties \"U.S. Gazetteer Counties (2000)\ngaz2k-places \"U.S. Gazetteer Places (2000)\ngaz2k-zips \"U.S. Gazetteer Zip Code Tabulation Areas (2000)\nfd-hrv-eng \"Croatian-English FreeDict Dictionary ver. 0.1.2\nfd-fin-por \"suomi-português FreeDict+WikDict dictionary ver. 2018.09.13\nfd-fin-bul \"suomi-български език FreeDict+WikDict dictionary ver. 2018.09.13\nfd-fra-bul \"français-български език FreeDict+WikDict dictionary ver. 2018.09.13\nfd-deu-swe \"Deutsch-Svenska FreeDict+WikDict dictionary ver. 2018.09.13\nfd-fin-swe \"suomi-Svenska FreeDict+WikDict dictionary ver. 2018.09.13\nfd-jpn-rus \"Japanese-Russian FreeDict Dictionary ver. 0.1\nfd-wol-fra \"Wolof - French FreeDict dictionary ver. 0.1\nfd-fra-pol \"français-język polski FreeDict+WikDict dictionary ver. 2018.09.13\nfd-eng-deu \"English-German FreeDict Dictionary ver. 0.3.7\nfd-deu-nld \"German-Dutch FreeDict Dictionary ver. 0.1.4\nfd-por-eng \"Portuguese-English FreeDict Dictionary ver. 0.2\nfd-spa-deu \"Spanish-German FreeDict Dictionary ver. 0.1\nfd-ces-eng \"Czech-English FreeDict Dictionary ver. 0.2.3\nfd-swe-fin \"Svenska-suomi FreeDict+WikDict dictionary ver. 2018.09.13\nfd-eng-pol \"English - Polish Piotrowski+Saloni/FreeDict dictionary ver. 0.2\nfd-pol-nor \"język polski-Norsk FreeDict+WikDict dictionary ver. 2018.09.13\nfd-eng-rom \"English-Romanian FreeDict Dictionary ver. 0.6.3\nfd-eng-fra \"English-French FreeDict Dictionary ver. 0.1.6\nfd-fin-ell \"suomi-ελληνικά FreeDict+WikDict dictionary ver. 2018.09.13\nfd-eng-lit \"English-Lithuanian FreeDict Dictionary ver. 0.7.2\nfd-ckb-kmr \"Sorani-Kurmanji Ferheng/FreeDict Dictionary ver. 0.2\nfd-ita-eng \"Italian-English FreeDict Dictionary ver. 0.2\nfd-pol-eng \"język polski-English FreeDict+WikDict dictionary ver. 2018.09.13\nfd-gle-eng \"Irish-English FreeDict Dictionary ver. 0.2\nfd-eng-tur \"English-Turkish FreeDict Dictionary ver. 0.3\nfd-gle-pol \"Irish-Polish FreeDict Dictionary ver. 0.1.2\nfd-pol-deu \"język polski-Deutsch FreeDict+WikDict dictionary ver. 2018.09.13\nfd-fra-spa \"français-español FreeDict+WikDict dictionary ver. 2018.09.13\nfd-lit-eng \"Lithuanian-English FreeDict Dictionary ver. 0.7.2\nfd-eng-jpn \"English-日本語 (にほんご) FreeDict+WikDict dictionary ver. 2018.09.13\nfd-ara-eng \"Arabic-English FreeDict Dictionary ver. 0.6.3\nfd-nld-ita \"Nederlands-italiano FreeDict+WikDict dictionary ver. 2018.09.13\nfd-eng-lat \"English-Latin FreeDict Dictionary ver. 0.1.2\nfd-eng-hun \"English-Hungarian FreeDict Dictionary ver. 0.2.1\nfd-ita-jpn \"italiano-日本語 (にほんご) FreeDict+WikDict dictionary ver. 2018.09.13\nfd-dan-eng \"Danish-English FreeDict Dictionary ver. 0.2.2\nfd-hun-eng \"Hungarian-English FreeDict Dictionary ver. 0.4.1\nfd-pol-gle \"Polish-Irish FreeDict Dictionary ver. 0.1.2\nfd-fra-fin \"français-suomi FreeDict+WikDict dictionary ver. 2018.09.13\nfd-nld-swe \"Nederlands-Svenska FreeDict+WikDict dictionary ver. 2018.09.13\nfd-nld-eng \"Dutch-English Freedict Dictionary ver. 0.2\nfd-deu-kur \"German-Kurdish Ferheng/FreeDict Dictionary ver. 0.2.2\nfd-deu-spa \"Deutsch-español FreeDict+WikDict dictionary ver. 2018.09.13\nfd-eng-afr \"English-Afrikaans FreeDict Dictionary ver. 0.1.3\nfd-eng-swe \"English-Swedish FreeDict Dictionary ver. 0.2\nfd-jpn-deu \"Japanese-German FreeDict Dictionary ver. 0.2.0\nfd-epo-eng \"Esperanto-English FreeDict dictionary ver. 1.0.1\nfd-pol-nld \"język polski-Nederlands FreeDict+WikDict dictionary ver. 2018.09.13\nfd-lat-deu \"Lateinisch-Deutsch FreeDict-Wörterbuch ver. 1.0.3\nfd-eng-cym \"Eurfa Saesneg, English-Welsh Eurfa/Freedict dictionary ver. 0.2.3\nfd-por-spa \"português-español FreeDict+WikDict dictionary ver. 2018.09.13\nfd-eng-spa \"English-Spanish FreeDict Dictionary ver. 0.3\nfd-swe-tur \"Svenska-Türkçe FreeDict+WikDict dictionary ver. 2018.09.13\nfd-tur-eng \"Turkish-English FreeDict Dictionary ver. 0.3\nfd-tur-deu \"Turkish-German FreeDict Dictionary ver. 0.2\nfd-pol-fra \"język polski-français FreeDict+WikDict dictionary ver. 2018.09.13\nfd-eng-por \"English-Portuguese FreeDict Dictionary ver. 0.3\nfd-ita-pol \"italiano-język polski FreeDict+WikDict dictionary ver. 2018.09.13\nfd-eng-ces \"English-Czech dicts.info/FreeDict Dictionary ver. 0.1.3\nfd-deu-tur \"German-Turkish Ferheng/FreeDict Dictionary ver. 0.2.2\nfd-fra-jpn \"français-日本語 (にほんご) FreeDict+WikDict dictionary ver. 2018.09.13\nfd-cym-eng \"Eurfa Cymraeg, Welsh-English Eurfa/Freedict dictionary ver. 0.2.3\nfd-bre-fra \"Breton-French FreeDict Dictionary (Geriadur Tomaz) ver. 0.8.3\nfd-jpn-fra \"Japanese-French FreeDict Dictionary ver. 0.1\nfd-nld-deu \"Dutch-German FreeDict Dictionary ver. 0.2\nfd-eng-nld \"English-Dutch FreeDict Dictionary ver. 0.2\nfd-deu-por \"German-Portuguese FreeDict Dictionary ver. 0.2.2\nfd-eng-hrv \"English-Croatian FreeDict Dictionary ver. 0.2.2\nfd-mkd-bul \"Macedonian - Bulgarian FreeDict Dictionary ver. 0.1.1\nfd-swe-eng \"Swedish-English FreeDict Dictionary ver. 0.2\nfd-pol-spa \"język polski-español FreeDict+WikDict dictionary ver. 2018.09.13\nfd-jpn-eng \"Japanese-English FreeDict Dictionary ver. 0.1\nfd-eng-ell \"English - Modern Greek XDXF/FreeDict dictionary ver. 0.1.1\nfd-ita-por \"italiano-português FreeDict+WikDict dictionary ver. 2018.09.13\nfd-pol-swe \"język polski-Svenska FreeDict+WikDict dictionary ver. 2018.09.13\nfd-pol-fin \"język polski-suomi FreeDict+WikDict dictionary ver. 2018.09.13\nfd-kur-tur \"Kurdish-Turkish Ferheng/FreeDict Dictionary ver. 0.1.2\nfd-ita-swe \"italiano-Svenska FreeDict+WikDict dictionary ver. 2018.09.13\nfd-eng-swh \"English-Swahili xFried/FreeDict Dictionary ver. 0.2.2\nfd-kha-eng \"Khasi-English FreeDict Dictionary ver. 0.2.2\nfd-fin-eng \"suomi-English FreeDict+WikDict dictionary ver. 2018.09.13\nfd-eng-hin \"English-Hindi FreeDict Dictionary ver. 1.6\nfd-spa-eng \"Spanish-English FreeDict Dictionary ver. 0.3\nfd-afr-eng \"Afrikaans-English FreeDict Dictionary ver. 0.2.2\nfd-ita-fin \"italiano-suomi FreeDict+WikDict dictionary ver. 2018.09.13\nfd-eng-fin \"English-suomi FreeDict+WikDict dictionary ver. 2018.09.13\nfd-fra-ita \"français-italiano FreeDict+WikDict dictionary ver. 2018.09.13\nfd-deu-rus \"Deutsch-Русский FreeDict+WikDict dictionary ver. 2018.09.13\nfd-deu-bul \"Deutsch-български език FreeDict+WikDict dictionary ver. 2018.09.13\nfd-deu-pol \"Deutsch-język polski FreeDict+WikDict dictionary ver. 2018.09.13\nfd-srp-eng \"Serbian - English FreeDict Dictionary ver. 0.2\nfd-kur-deu \"Kurdish-German Ferheng/FreeDict Dictionary ver. 0.1.2\nfd-spa-por \"Spanish-Portuguese FreeDict Dictionary ver. 0.2.1\nfd-swe-pol \"Svenska-język polski FreeDict+WikDict dictionary ver. 2018.09.13\nfd-swe-rus \"Svenska-Русский FreeDict+WikDict dictionary ver. 2018.09.13\nfd-nld-spa \"Nederlands-español FreeDict+WikDict dictionary ver. 2018.09.13\nfd-swh-pol \"Swahili-Polish SSSP/FreeDict Dictionary ver. 0.2.3\nfd-oci-cat \"Lenga d'òc - Català FreeDict Dictionary ver. 0.1.1\nfd-ita-rus \"italiano-Русский FreeDict+WikDict dictionary ver. 2018.09.13\nfd-fra-ell \"français-ελληνικά FreeDict+WikDict dictionary ver. 2018.09.13\nfd-eng-srp \"English-Serbian FreeDict Dictionary ver. 0.1.3\nfd-fra-tur \"français-Türkçe FreeDict+WikDict dictionary ver. 2018.09.13\nfd-fra-eng \"French-English FreeDict Dictionary ver. 0.4.1\nfd-ita-ell \"italiano-ελληνικά FreeDict+WikDict dictionary ver. 2018.09.13\nfd-kur-eng \"Kurdish-English Ferheng/FreeDict Dictionary ver. 1.2\nfd-swe-deu \"Svenska-Deutsch FreeDict+WikDict dictionary ver. 2018.09.13\nfd-swe-fra \"Svenska-français FreeDict+WikDict dictionary ver. 2018.09.13\nfd-swe-lat \"Svenska-latine FreeDict+WikDict dictionary ver. 2018.09.13\nfd-swe-ell \"Svenska-ελληνικά FreeDict+WikDict dictionary ver. 2018.09.13\nfd-eng-rus \"English-Russian FreeDict Dictionary ver. 0.3.1\nfd-pol-por \"język polski-português FreeDict+WikDict dictionary ver. 2018.09.13\nfd-gla-deu \"Scottish Gaelic-German FreeDict Dictionary ver. 0.2\nfd-eng-ita \"English-Italian FreeDict Dictionary ver. 0.1.2\nfd-pol-ita \"język polski-italiano FreeDict+WikDict dictionary ver. 2018.09.13\nfd-fra-swe \"français-Svenska FreeDict+WikDict dictionary ver. 2018.09.13\nfd-isl-eng \\íslenska - English FreeDict Dictionary ver. 0.1.1\nfd-swe-spa \"Svenska-español FreeDict+WikDict dictionary ver. 2018.09.13\nfd-nno-nob \"Norwegian Nynorsk-Norwegian Bokmål FreeDict Dictionary ver. 0.1.1\nfd-swe-ita \"Svenska-italiano FreeDict+WikDict dictionary ver. 2018.09.13\nfd-fra-deu \"français-Deutsch FreeDict+WikDict dictionary ver. 2018.09.13\nfd-fin-ita \"suomi-italiano FreeDict+WikDict dictionary ver. 2018.09.13\nfd-nld-fra \"Nederlands-French FreeDict Dictionary ver. 0.2\nfd-eng-ara \"English-Arabic FreeDict Dictionary ver. 0.6.3\nfd-slk-eng \"Slovak-English FreeDict Dictionary ver. 0.2.1\nfd-fra-por \"français-português FreeDict+WikDict dictionary ver. 2018.09.13\nfd-spa-ast \"Spanish - Asturian FreeDict Dictionary ver. 0.1.1\nfd-fin-jpn \"suomi-日本語 (にほんご) FreeDict+WikDict dictionary ver. 2018.09.13\nfd-deu-ita \"German-Italian FreeDict Dictionary ver. 0.2\nfd-swh-eng \"Swahili-English xFried/FreeDict Dictionary ver. 0.4.4\nfd-fin-nor \"suomi-Norsk FreeDict+WikDict dictionary ver. 2018.09.13\nfd-fra-nld \"French-Dutch FreeDict Dictionary ver. 0.2\nfd-lat-eng \"Latin-English FreeDict Dictionary ver. 0.1.2\nfd-eng-bul \"English-български език FreeDict+WikDict dictionary ver. 2018.09.13\nfd-deu-fra \"Deutsch-français FreeDict+WikDict dictionary ver. 2018.09.13\nfd-swe-bul \"Svenska-български език FreeDict+WikDict dictionary ver. 2018.09.13\nfd-deu-eng \"German-English FreeDict Dictionary ver. 0.3.5\nfd-pol-rus \"język polski-Русский FreeDict+WikDict dictionary ver. 2018.09.13\nfd-ita-deu \"Italian-German FreeDict Dictionary ver. 0.2\nfd-eng-gle \"English-Irish FreeDict Dictionary ver. 0.3.2\nfd-swe-por \"Svenska-português FreeDict+WikDict dictionary ver. 2018.09.13\nfd-afr-deu \"Afrikaans-German FreeDict Dictionary ver. 0.3.2\nfd-por-deu \"Portuguese-German FreeDict Dictionary ver. 0.2\nfd-fra-bre \"French-Breton FreeDict Dictionary (Geriadur Tomaz) ver. 0.2.7\nfd-san-deu \"Sanskrit-German FreeDict Dictionary ver. 0.2.2\nfd-kha-deu \"Khasi - German FreeDict Dictionary ver. 0.1.3\nfd-fra-rus \"français-Русский FreeDict+WikDict dictionary ver. 2018.09.13\nfd-pol-ell \"język polski-ελληνικά FreeDict+WikDict dictionary ver. 2018.09.13\nenglish \"English Monolingual Dictionaries\ntrans \"Translating Dictionaries\nall \"All Dictionaries (English-Only and Translating)\n.\n250 ok\n"
        );

        @Override
        public String query(String query) {
            return cannedResponses.get(query);
        }
    }

    @Test
    void define() throws IOException {
        DICTClient.Backend backend = new StubBackend();
        DICTClient c = new DICTClient(backend);
        assertEquals(
                "[Definition[headword=Hello, databaseID=test, databaseDescription=Test Dictionary, text=A greeting]]",
                c.define("test", "hello").toString());

        List<DICTClient.Definition> definitionList = c.define("gcide", "hello");
        assertEquals(1, definitionList.size());
        DICTClient.Definition def = definitionList.getFirst();
        assertEquals("Hello", def.headword());
        assertEquals("gcide", def.databaseID());

        definitionList = c.define("*", "hello");
        assertEquals(4, definitionList.size());
    }

    @Test
    void listDatabases() throws IOException {
        DICTClient.Backend backend = new StubBackend();
        DICTClient c = new DICTClient(backend);
        List <DICTClient.Database> databases = c.listDatabases();

        assertEquals(166, databases.size());
        assertEquals("gcide", databases.get(0).databaseID());
        assertEquals("WordNet (r) 3.0 (2006)", databases.get(1).databaseDescription());
    }
}